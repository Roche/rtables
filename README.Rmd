---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)
```

# rtables

[![Build Status](https://travis-ci.org/Roche/rtables.svg?branch=master)](https://travis-ci.org/Roche/rtables/)


## Reporting tables with R

The `rtables` R package was designed to create and display complex tables with R. The cells in an `rtable` may contain
any high-dimensional data structure which can then be displayed with cell-specific formatting instructions. Currently,
`rtables` can be outputted in `ascii` and `html`.

Note: we have completely refactored the `rtables` package. The new changes are available with the n we officially
released as per January 2021. If you have learned the pre-2021 `rtables` framework then please spend some time
familiarizing yourself with the new framework, there is details in the vignettes.

`rtables` is funded by `F. Hoffmann-La Roche` with the aim to analyze clinical trials data and to create tables that can
be used for regulatory submissions to the health authorities. Hence, roughly summarized the requirements and reasons to
create this new table package are:

* cell values and their visualization separate (i.e. no string based tables)
* multiple values displayed within a cell
* values need to be programmatically accessible in their non-rounded state for cross-checking
* flexible formatting (cell spans, rounding, alignment, etc.)
* composition of an `rtable` object from other `rtables` objects
* multiple output formats (html, ascii, latex, pdf, xml)
* flexible pagination
* title, footnotes, cell cell/row/column references
* flexible tabulation framework

Note that the current state of `rtables` does not fulfill all of those requirements, however, `rtables` is still under
active development and we are working on adding the missing features.


## Installation

`rtables` is now available on CRAN and you can install the latest released version with:

```r
install.packages("rtables")
```

or you can install the latest stable version directly from GitHub with:

```r
devtool::install_github("Roche/rtables")
```

To install a frozen pre-release version of `rtables` based on the new Layouting and Tabulation API as presented at
user!2020 and JSM2020 run the following command in `R`:

```{r, eval = FALSE}
devtools::install_github("roche/rtables", ref="v0.3.2.3")
```

To install the latest development version of the new test version of `rtables` run

```{r, eval = FALSE}
devtools::install_github("roche/rtables", ref = "gabe_tabletree_work")
```


## Usage

```{r}
library(rtables)
library(dplyr)

## for simplicity grab non-sparse subset
ADSL = ex_adsl %>% filter(RACE %in% levels(RACE)[1:3])

biomarker_ave = function(x, ...) {
     val = if(length(x) > 0) round(mean(x), 2) else "no data"
     in_rows(
        "Biomarker 1 (mean)" = rcell(val)
     )
}

basic_table() %>%
  split_cols_by("ARM") %>%
  split_cols_by("BMRKR2") %>%
  add_colcounts() %>%
  split_rows_by("RACE", split_fun = trim_levels_in_group("SEX")) %>%
  split_rows_by("SEX") %>%
  summarize_row_groups() %>%
  analyze("BMRKR1", biomarker_ave) %>%
  build_table(ADSL)
```


# Acknowledgements

We would like to thank everyone who has made `rtables` a better project by providing feedback and improving examples & vignettes. The following list of contributors is alphabetical:

Maximo Carreras, Francois Collins, Saibah Chohan, Tadeusz Lewandowski, Nick Paszty, Nina Qi, Jana Stoilova, Heng Wang, Godwin Yung

## Presentations

### New (Current) Layouting and Tabulation Framework (v.0.3+)

* [useR!2020 Presentation (on v0.3.1.1) July 2020](https://www.youtube.com/watch?v=CBQzZ8ZhXLA)

### v0.1.0 and previous

* [Presentation on v0.1.0 April 2018](https://docs.google.com/presentation/d/1bpdBDp4PZdZ4hCsfaPkAuHDVnJmtp7WBIZ19oKMDq0M/edit?usp=sharing)

* [baselR November
2017](https://docs.google.com/presentation/d/1V28AVo9aVNfw2FTuRgQyM4BJKalVQMFD8lKUD2KlzKI/edit?usp=sharing),
this presentation was written for version `v0.0.1`
